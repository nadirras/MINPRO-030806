// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Sample {
  id        Int      @id @default(autoincrement())
  name      String
  code      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("samples") // if you want to use snake_case format
}

enum Gender {
  Laki_laki
  Perempuan
}

enum Role {
  EventCreator
  Pembeli
}

enum DiscountStatus {
  Active
  Expired
}

enum PointStatus {
  Active
  Expired
}

enum StatusOrder {
  Pending
  WaitingConfirmation
  Paid
  Cancel
}

enum EventCategory {
  Festival
  Attraction
  Workshop
  Seminar
}

model User {
  id               Int               @id @default(autoincrement())
  username         String            @unique
  email            String            @unique
  password         String
  usedReferralCode String? // Kode referral yang digunakan saat registrasi
  createdAt        DateTime          @default(now())
  activation       Boolean?          @default(false)
  referral         Referral?
  UserDetail       UserDetail?
  discountVoucher  DiscountVoucher[]
  Points           Points[]
  Cart             Cart?
}

model UserDetail {
  id            Int      @id @default(autoincrement())
  user          User     @relation(fields: [userId], references: [id])
  userId        Int      @unique
  nama_depan    String
  nama_belakang String
  jenis_kelamin Gender
  tanggal_lahir DateTime
  nomor_telepon String
  photo_profile String?  @db.LongText
}

model Referral {
  id             Int      @id @default(autoincrement())
  user           User     @relation(fields: [userId], references: [id])
  userId         Int      @unique
  myReferralCode String
  createdAt      DateTime @default(now())
}

model DiscountVoucher {
  id                 Int            @id @default(autoincrement())
  user               User           @relation(fields: [userId], references: [id])
  userId             Int
  discountCoupon     String
  discountPercentage Int
  createdAt          DateTime       @default(now())
  expired_date       DateTime
  discount_status    DiscountStatus
  EventItem          EventItem[]
}

model Points {
  id           Int         @id @default(autoincrement())
  user         User        @relation(fields: [userId], references: [id])
  userId       Int
  points       Int         @default(0) //jumlah poin atau skor yang dimiliki pengguna, terkait dengan penggunaan kode referral.
  createdAt    DateTime    @default(now())
  expired_date DateTime
  point_status PointStatus
}

model EventOrganizer {
  id                  Int     @id @default(autoincrement())
  userId              Int
  eventOrganizer      String  @unique //biar gak ada event organizer dobel
  eventImgOrganizer   String  @db.LongText
  contactPerson       String
  contactPersonNumber String
  DetailEvent         Event[]
}

model Event {
  id               Int            @id @default(autoincrement())
  eventOrganizer   EventOrganizer @relation(fields: [eventOrganizerId], references: [id])
  eventOrganizerId Int
  eventCategory    EventCategory
  eventName        String         @unique
  eventSlug        String         @unique
  eventImage       String         @db.LongText
  description      String?        @db.LongText
  availableSeats   Int
  startDate        DateTime?
  endDate          DateTime?
  startTime        String
  endTime          String
  location         String?
  EventItem        EventItem[]
  CartItem         CartItem[]
  OrderItem        OrderItem[]
  Review           Review[]
  EventPrice       EventPrice?
}

model EventPrice {
  id          Int     @id @default(autoincrement())
  event       Event   @relation(fields: [eventId], references: [id])
  eventId     Int     @unique
  isPaid      Boolean @default(false)
  ticketPrice Int
}

model EventItem {
  id                Int             @id @default(autoincrement())
  event             Event           @relation(fields: [eventId], references: [id])
  eventId           Int
  discountVoucher   DiscountVoucher @relation(fields: [discountVoucherId], references: [id])
  discountVoucherId Int
}

model Cart {
  id       Int        @id @default(autoincrement())
  userId   Int        @unique
  user     User       @relation(fields: [userId], references: [id])
  discount Int? //ini terserah mau make kupon atau enggak
  CartItem CartItem[]
}

model CartItem {
  id       Int   @id @default(autoincrement())
  cartId   Int
  eventId  Int
  quantity Int
  cart     Cart  @relation(fields: [cartId], references: [id])
  event    Event @relation(fields: [eventId], references: [id])
}

model Order {
  id          Int         @id @default(autoincrement())
  userId      Int
  total       Int
  status      StatusOrder
  orderDate   DateTime    @default(now())
  expiredDate DateTime    @default(now())
  OrderItem   OrderItem[]
  Payment     Payment?
}

model OrderItem {
  id       Int   @id @default(autoincrement())
  orderId  Int
  eventId  Int
  quantity Int
  order    Order @relation(fields: [orderId], references: [id])
  event    Event @relation(fields: [eventId], references: [id])
}

model Payment {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  imageUrl  String
  orderId   Int      @unique
  order     Order    @relation(fields: [orderId], references: [id])
}

model Review {
  id        Int      @id @default(autoincrement())
  userId    Int
  eventId   Int
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  event     Event    @relation(fields: [eventId], references: [id])
}
